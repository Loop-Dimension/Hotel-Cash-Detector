{% load static %}
<!DOCTYPE html>
<html lang="{{ current_lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ t.app_name }}{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="app-shell">
        <!-- Header -->
        <header class="top-bar">
            <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="brand">{{ t.app_short }}</div>
            <div class="top-actions">
                <!-- Language Switch -->
                <div class="lang-switch">
                    <button class="lang-btn {% if current_lang == 'ko' %}active{% endif %}" onclick="setLanguage('ko')">ÌïúÍµ≠Ïñ¥</button>
                    <button class="lang-btn {% if current_lang == 'en' %}active{% endif %}" onclick="setLanguage('en')">EN</button>
                </div>
                <span class="user-info">{{ user.first_name|default:user.username }}</span>
                <a href="{% url 'cctv:logout' %}" class="logout-btn">{{ t.logout }}</a>
            </div>
        </header>

        <div class="layout {% if sidebar_collapsed %}layout-collapsed{% endif %}" id="mainLayout">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <button class="collapse-btn" id="toggleSidebar" aria-label="Toggle Sidebar">
                        ‚Üê
                    </button>
                </div>
                <nav class="nav-list">
                    {% if user.is_admin %}
                    <!-- Admin Navigation -->
                    <a href="{% url 'cctv:home' %}" class="nav-item {% if active_page == 'home' %}active{% endif %}">
                        <span class="nav-icon">üè†</span>
                        <span class="nav-label">{{ t.nav_home }}</span>
                    </a>
                    
                    <div class="nav-group">
                        <button class="nav-item nav-parent" type="button">
                            <span class="nav-icon">üìπ</span>
                            <span class="nav-label">{{ t.nav_monitor }}</span>
                            <span class="caret {% if 'monitor' in active_page %}open{% endif %}">‚ñº</span>
                        </button>
                        <div class="nav-sublist" style="{% if 'monitor' in active_page %}display:flex{% endif %}">
                            <a href="{% url 'cctv:monitor_all' %}" class="nav-item nav-sub {% if active_page == 'monitor-all' %}active{% endif %}">
                                <span class="nav-dot"></span>
                                <span class="nav-label">{{ t.nav_monitor_all }}</span>
                            </a>
                            <a href="{% url 'cctv:monitor_local' %}" class="nav-item nav-sub {% if active_page == 'monitor-local' %}active{% endif %}">
                                <span class="nav-dot"></span>
                                <span class="nav-label">{{ t.nav_monitor_local }}</span>
                            </a>
                        </div>
                    </div>
                    
                    <div class="nav-group">
                        <button class="nav-item nav-parent" type="button">
                            <span class="nav-icon">üé¨</span>
                            <span class="nav-label">{{ t.nav_video }}</span>
                            <span class="caret {% if 'video' in active_page %}open{% endif %}">‚ñº</span>
                        </button>
                        <div class="nav-sublist" style="{% if 'video' in active_page %}display:flex{% endif %}">
                            <a href="{% url 'cctv:video_logs' %}" class="nav-item nav-sub {% if active_page == 'video-logs' %}active{% endif %}">
                                <span class="nav-dot"></span>
                                <span class="nav-label">{{ t.nav_video_logs }}</span>
                            </a>
                            <a href="{% url 'cctv:video_full' %}" class="nav-item nav-sub {% if active_page == 'video-full' %}active{% endif %}">
                                <span class="nav-dot"></span>
                                <span class="nav-label">{{ t.nav_video_full }}</span>
                            </a>
                        </div>
                    </div>
                    
                    <div class="nav-group">
                        <button class="nav-item nav-parent" type="button">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            <span class="nav-label">{{ t.nav_manage }}</span>
                            <span class="caret {% if 'manage' in active_page %}open{% endif %}">‚ñº</span>
                        </button>
                        <div class="nav-sublist" style="{% if 'manage' in active_page %}display:flex{% endif %}">
                            <a href="{% url 'cctv:manage_branches' %}" class="nav-item nav-sub {% if active_page == 'manage-branches' %}active{% endif %}">
                                <span class="nav-dot"></span>
                                <span class="nav-label">{{ t.nav_manage_branches }}</span>
                            </a>
                        </div>
                    </div>
                    
                    <a href="{% url 'cctv:reports' %}" class="nav-item {% if active_page == 'reports' %}active{% endif %}">
                        <span class="nav-icon">üìä</span>
                        <span class="nav-label">{{ t.nav_reports }}</span>
                    </a>
                    
                    <a href="{% url 'cctv:test_detection' %}" class="nav-item {% if active_page == 'test' %}active{% endif %}">
                        <span class="nav-icon">üß™</span>
                        <span class="nav-label">Test Detection</span>
                    </a>
                    
                    {% else %}
                    <!-- Project Manager Navigation -->
                    <a href="{% url 'cctv:home' %}" class="nav-item {% if active_page == 'home' %}active{% endif %}">
                        <span class="nav-icon">üè†</span>
                        <span class="nav-label">{{ t.nav_home }}</span>
                    </a>
                    
                    <div class="nav-group">
                        <button class="nav-item nav-parent" type="button">
                            <span class="nav-icon">üìπ</span>
                            <span class="nav-label">{{ t.nav_monitor }}</span>
                            <span class="caret {% if 'monitor' in active_page %}open{% endif %}">‚ñº</span>
                        </button>
                        <div class="nav-sublist" style="{% if 'monitor' in active_page %}display:flex{% endif %}">
                            <a href="{% url 'cctv:monitor_local' %}" class="nav-item nav-sub {% if active_page == 'monitor-local' %}active{% endif %}">
                                <span class="nav-dot"></span>
                                <span class="nav-label">{{ t.nav_monitor_local }}</span>
                            </a>
                        </div>
                    </div>
                    
                    <div class="nav-group">
                        <button class="nav-item nav-parent" type="button">
                            <span class="nav-icon">üé¨</span>
                            <span class="nav-label">{{ t.nav_video }}</span>
                            <span class="caret {% if 'video' in active_page %}open{% endif %}">‚ñº</span>
                        </button>
                        <div class="nav-sublist" style="{% if 'video' in active_page %}display:flex{% endif %}">
                            <a href="{% url 'cctv:video_logs' %}" class="nav-item nav-sub {% if active_page == 'video-logs' %}active{% endif %}">
                                <span class="nav-dot"></span>
                                <span class="nav-label">{{ t.nav_video_logs }}</span>
                            </a>
                            <a href="{% url 'cctv:video_full' %}" class="nav-item nav-sub {% if active_page == 'video-full' %}active{% endif %}">
                                <span class="nav-dot"></span>
                                <span class="nav-label">{{ t.nav_video_full }}</span>
                            </a>
                        </div>
                    </div>
                    {% endif %}
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="content">
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>

    <!-- Modal Container -->
    <div id="modalContainer"></div>

    <script src="{% static 'js/main.js' %}"></script>
    <script>
        // Language switching
        function setLanguage(lang) {
            fetch('{% url "cctv:set_language" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ lang: lang })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.reload();
                }
            });
        }
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>
